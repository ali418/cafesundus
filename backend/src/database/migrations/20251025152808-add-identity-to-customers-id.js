'use strict';

/** @type {import('sequelize-cli').Migration} */
module.exports = {
  async up (queryInterface, Sequelize) {
    // Ensure customers.id uses Postgres IDENTITY for auto-increment
    await queryInterface.sequelize.query(`
      DO $$
      BEGIN
        IF NOT EXISTS (
          SELECT 1
          FROM information_schema.columns
          WHERE table_name = 'customers'
            AND column_name = 'id'
            AND is_identity = 'YES'
        ) THEN
          ALTER TABLE customers
          ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY;
        END IF;
      END
      $$;
    `);
  },

  async down (queryInterface, Sequelize) {
    await queryInterface.sequelize.query(`
      ALTER TABLE customers
      ALTER COLUMN id DROP IDENTITY IF EXISTS;
    `);
  }
};
