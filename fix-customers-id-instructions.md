# تعليمات إصلاح عمود customers.id في قاعدة البيانات

## المشكلة

تظهر رسالة خطأ عند إنشاء طلب جديد:

```
ERROR: null value in column "id" of relation "customers" violates not-null constraint
```

السبب هو أن عمود `id` في جدول `customers` غير مهيأ للتوليد التلقائي (auto-increment) في قاعدة البيانات PostgreSQL على Railway.

## الحلول المتاحة

### الحل 1: تنفيذ سكريبت SQL مباشرة في وحدة تحكم Railway

1. افتح لوحة تحكم Railway
2. انتقل إلى قاعدة البيانات PostgreSQL
3. افتح وحدة تحكم SQL
4. نفذ الأمر التالي:

```sql
ALTER TABLE customers 
ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY;
```

### الحل 2: تشغيل سكريبت Node.js

1. قم بتنزيل المشروع المحدث من GitHub
2. انتقل إلى مجلد المشروع
3. نفذ الأوامر التالية:

```bash
cd backend
npm install
node src/scripts/fix-customers-id.js
```

### الحل 3: إعادة تشغيل الخادم على Railway

قمنا بإضافة فحص تلقائي في `backend/src/index.js` يقوم بإصلاح المشكلة عند بدء تشغيل الخادم. يمكنك ببساطة إعادة تشغيل الخادم على Railway وسيتم إصلاح المشكلة تلقائيًا.

## التحقق من الإصلاح

بعد تنفيذ أحد الحلول، يمكنك التحقق من نجاح الإصلاح بتنفيذ الاستعلام التالي في وحدة تحكم SQL:

```sql
SELECT is_identity, column_default 
FROM information_schema.columns 
WHERE table_schema = 'public' 
AND table_name = 'customers' 
AND column_name = 'id';
```

يجب أن تكون قيمة `is_identity` هي `YES`.

## اختبار الإصلاح

بعد تنفيذ الإصلاح، جرب إنشاء طلب جديد من واجهة المستخدم. يجب أن يعمل بدون أخطاء.

## ملاحظات إضافية

- تأكد من أن لديك نسخة احتياطية من قاعدة البيانات قبل تنفيذ أي تغييرات.
- إذا كنت تستخدم خدمة استضافة أخرى غير Railway، قد تختلف خطوات الإصلاح قليلاً.
- إذا استمرت المشكلة، تحقق من سجلات الخادم للحصول على مزيد من المعلومات.